{{define "title"}}Categories{{end}}

{{define "head"}}
<script>
  function toggleEditForm(categoryName) {
    const editForm = document.getElementById(`edit-form-${categoryName}`);
    const categoryItem = document.getElementById(`category-${categoryName}`);
    
    if (editForm.classList.contains('edit-form-visible')) {
      editForm.classList.remove('edit-form-visible');
      categoryItem.querySelector('.category-name').style.display = 'block';
      categoryItem.querySelector('.category-actions').style.display = 'flex';
    } else {
      editForm.classList.add('edit-form-visible');
      categoryItem.querySelector('.category-name').style.display = 'none';
      categoryItem.querySelector('.category-actions').style.display = 'none';
      
      // Focus on the input field
      const input = editForm.querySelector('input[name="new_name"]');
      input.focus();
      input.setSelectionRange(0, input.value.length);
    }
  }
</script>
{{end}}

{{define "content"}}
<div class="header-container">
  <h1 class="page-title">Categories</h1>
</div>

<div class="button-container">
  <a href="/" class="main-btn">
    <i class="material-icons">arrow_back</i> BACK TO MAIN LIST
  </a>

  <a href="/add-task-page" class="done-btn" style="background-color: #FF4081;">
    <i class="material-icons">add</i> NEW TASK
  </a>
</div>

<div class="category-form-container">
  <form action="/add-category" method="POST" class="category-form">
    <div class="input-group">
      <label class="input-label">Category Name</label>
      <input class="input-field" type="text" name="name" required>
    </div>
    <button class="add-btn" type="submit">ADD CATEGORY</button>
  </form>
</div>

<ul class="category-list">
  {{range .}}
  <li class="category-item" id="category-{{.Name}}">
    <span class="category-name">{{.Name}}</span>
    <div class="category-actions">
      <button class="edit-btn" onclick="toggleEditForm('{{.Name}}')">EDIT</button>
      <a href="/delete-category?name={{.Name}}" class="delete-btn">DELETE</a>
    </div>
    <div class="edit-form" id="edit-form-{{.Name}}">
      <form action="/edit-category" method="POST" class="edit-form-content">
        <input type="hidden" name="old_name" value="{{.Name}}">
        <input type="text" name="new_name" value="{{.Name}}" required>
        <button type="submit" class="save-btn">SAVE</button>
        <button type="button" class="cancel-btn" onclick="toggleEditForm('{{.Name}}')">CANCEL</button>
      </form>
    </div>
  </li>
  {{end}}
</ul>
{{end}}

{{define "categories"}}
  {{template "layout" .}}
{{end}}
